# GRUB configuration file for LoongArch64
# This file is used by the QEMU boot script

set timeout=10
set default=0

# Enable serial console
serial --unit=0 --speed=115200
terminal_input serial
terminal_output serial

# Set default boot entry
set default="GRUB LoongArch64"

menuentry "GRUB LoongArch64" {
    echo "Loading GRUB for LoongArch64..."
    echo "Welcome to LoongArch64 GRUB Bootloader"
    echo ""
    echo "Available commands:"
    echo "  - ls: List files and directories"
    echo "  - cat: Display file contents"
    echo "  - set: Set GRUB variables"
    echo "  - insmod: Load GRUB modules"
    echo "  - help: Show help information"
    echo ""
    echo "Press any key to continue to GRUB shell..."
    sleep --interruptible 5
    shell
}

menuentry "GRUB Shell" {
    echo "Starting GRUB shell..."
    shell
}

menuentry "Boot from EFI" {
    echo "Attempting to boot from EFI..."
    # Try to find and boot EFI applications
    search --file --set=root /EFI/BOOT/BOOTLOONGARCH64.EFI
    if [ -n "$root" ]; then
        echo "Found EFI bootloader at $root"
        chainloader /EFI/BOOT/BOOTLOONGARCH64.EFI
    else
        echo "No EFI bootloader found"
        echo "Falling back to shell..."
        sleep 2
        shell
    fi
}

menuentry "System Information" {
    echo "=== System Information ==="
    echo "Architecture: LoongArch64"
    echo "CPU: LA464"
    echo "Memory: 2GB"
    echo "Boot method: UEFI"
    echo "========================="
    echo ""
    echo "GRUB modules loaded:"
    lsmod
    echo ""
    echo "Available devices:"
    ls
    echo ""
    echo "Press any key to return to menu..."
    sleep --interruptible 10
}

menuentry "Reboot" {
    echo "Rebooting system..."
    reboot
}

menuentry "Shutdown" {
    echo "Shutting down system..."
    halt
}
